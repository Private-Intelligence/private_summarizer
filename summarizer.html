<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Summarizer - Private AI Text Summarization</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;600&family=Noto+Sans+JP:wght@300;400;500&family=Noto+Sans+SC:wght@300;400;500&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #fafaf8;
            --bg-secondary: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --accent: #c44536;
            --border: #e8e8e4;
            --shadow: rgba(0, 0, 0, 0.04);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Noto Sans JP', 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #fafaf8 0%, #f5f5f0 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem;
            animation: fadeIn 0.6s ease-out;
        }

        body.lang-ja {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
        }

        body.lang-zh {
            font-family: 'Noto Sans SC', 'Inter', sans-serif;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            animation: slideDown 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Crimson Pro', serif;
            font-size: 3rem;
            font-weight: 300;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 300;
            letter-spacing: 0.05em;
        }

        .top-bar {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .language-switcher {
            display: flex;
            gap: 0.5rem;
            background: var(--bg-secondary);
            padding: 0.5rem;
            border-radius: 50px;
            box-shadow: 0 2px 10px var(--shadow);
            border: 1px solid var(--border);
        }

        .lang-btn {
            background: transparent;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .lang-btn:hover {
            background: var(--bg-primary);
        }

        .lang-btn.active {
            background: var(--accent);
            color: white;
        }

        .settings-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            width: 42px;
            height: 42px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .settings-btn:hover {
            background: var(--bg-primary);
            color: var(--accent);
        }

        .workspace {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            animation: fadeInUp 1s cubic-bezier(0.16, 1, 0.3, 1) 0.2s backwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .panel {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
            overflow: hidden;
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .panel:hover::before {
            opacity: 1;
        }

        .panel:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px var(--shadow);
        }

        .panel-title {
            font-family: 'Crimson Pro', serif;
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .icon {
            font-size: 1.2rem;
            opacity: 0.6;
        }

        .sample-note {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            font-style: italic;
        }

        textarea {
            width: 100%;
            min-height: 400px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-family: inherit;
            font-size: 0.95rem;
            line-height: 1.8;
            resize: vertical;
            transition: all 0.3s ease;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(196, 69, 54, 0.1);
        }

        .output {
            min-height: 400px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-family: inherit;
            font-size: 0.95rem;
            line-height: 1.8;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .output h3 {
            font-weight: 600;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }

        .output h3:first-child {
            margin-top: 0;
        }

        .output ul,
        .output ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .output li {
            margin-bottom: 0.5rem;
        }

        .output p {
            margin-bottom: 0.5rem;
        }

        .output code {
            background: var(--border);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
            font-size: 0.9em;
        }

        .output em {
            font-style: italic;
        }

        .output strong {
            font-weight: 600;
        }

        .output.loading {
            background: linear-gradient(90deg, var(--bg-primary) 0%, #f0f0ec 50%, var(--bg-primary) 100%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .output:empty::before {
            content: attr(data-placeholder);
            color: var(--text-secondary);
            opacity: 0.5;
            font-style: italic;
        }

        button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 50px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 4px 15px rgba(196, 69, 54, 0.2);
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(196, 69, 54, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
            animation: fadeInUp 1s cubic-bezier(0.16, 1, 0.3, 1) 0.4s backwards;
        }

        .status {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            min-height: 1.5rem;
        }

        .status.error {
            color: var(--accent);
        }

        .status.success {
            color: #2d7d46;
        }

        .privacy-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #e8f5e9;
            color: #2d7d46;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 0.5rem;
        }

        /* Settings Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-family: 'Crimson Pro', serif;
            font-size: 1.5rem;
            font-weight: 400;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0.5rem;
            box-shadow: none;
        }

        .modal-close:hover {
            color: var(--accent);
            transform: none;
            box-shadow: none;
        }

        .setting-group {
            margin-bottom: 1.5rem;
        }

        .setting-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .setting-hint {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .setting-group textarea {
            min-height: 150px;
            font-size: 0.9rem;
        }

        .setting-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.9rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(196, 69, 54, 0.1);
        }

        .model-defaults {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .setting-group input[type="range"] {
            width: 100%;
            margin-top: 0.5rem;
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .btn-secondary {
            background: var(--text-secondary);
        }

        .btn-reset {
            background: transparent;
            color: var(--text-secondary);
            box-shadow: none;
        }

        .btn-reset:hover {
            color: var(--accent);
            box-shadow: none;
        }

        /* First run notice */
        .notice {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .notice.show {
            display: block;
        }

        .notice-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .notice-text {
            font-size: 0.9rem;
            color: #856404;
        }

        .notice-close {
            float: right;
            background: none;
            border: none;
            cursor: pointer;
            color: #856404;
            font-size: 1.2rem;
            padding: 0;
            box-shadow: none;
        }

        .notice-close:hover {
            transform: none;
            box-shadow: none;
        }

        @media (max-width: 968px) {
            .workspace {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2rem;
            }

            body {
                padding: 1rem;
            }

            .top-bar {
                position: relative;
                top: 0;
                right: 0;
                justify-content: center;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-bar">
            <div class="language-switcher">
                <button class="lang-btn active" onclick="setLanguage('en')">EN</button>
                <button class="lang-btn" onclick="setLanguage('zh')">‰∏≠Êñá</button>
                <button class="lang-btn" onclick="setLanguage('ja')">Êó•Êú¨Ë™û</button>
            </div>
            <button class="settings-btn" onclick="openSettings()" title="Settings">‚öôÔ∏è</button>
        </div>

        <header>
            <h1 data-i18n="title">Local Summarizer</h1>
            <p class="subtitle" data-i18n="subtitle">Private AI Text Summarization</p>
            <div class="privacy-badge">
                <span>üîí</span>
                <span data-i18n="privacy">100% Private - Runs Locally</span>
            </div>
        </header>

        <div id="firstRunNotice" class="notice">
            <button class="notice-close" onclick="dismissNotice()">√ó</button>
            <div class="notice-title" data-i18n="noticeTitle">First Run Notice</div>
            <div class="notice-text" data-i18n="noticeText">The AI model (~2.5GB) will be downloaded on first use. This may take a few minutes depending on your connection. Subsequent runs will be much faster.</div>
        </div>

        <div class="workspace">
            <div class="panel">
                <h2 class="panel-title"><span class="icon">üìù</span><span data-i18n="inputTitle">Input Text</span></h2>
                <p class="sample-note" data-i18n="sampleNote">Sample call transcript loaded. Feel free to replace with your own text.</p>
                <textarea id="inputText" data-i18n-placeholder="inputPlaceholder" placeholder="Enter text to summarize..."></textarea>
            </div>

            <div class="panel">
                <h2 class="panel-title"><span class="icon">‚ú®</span><span data-i18n="outputTitle">Summary</span></h2>
                <div id="outputText" class="output" data-placeholder="Summary will appear here..."></div>
            </div>
        </div>

        <div class="controls">
            <button id="summarizeBtn" onclick="summarize()" data-i18n="summarizeBtn">Generate Summary</button>
            <button onclick="clearAll()" style="background: var(--text-secondary);" data-i18n="clearBtn">Clear</button>
        </div>

        <div id="status" class="status"></div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" data-i18n="settingsTitle">Settings</h2>
                <button class="modal-close" onclick="closeSettings()">√ó</button>
            </div>

            <div class="setting-group">
                <label class="setting-label" data-i18n="modelLabel">Model</label>
                <p class="setting-hint" data-i18n="modelHint">Enter a Hugging Face model ID. Leave empty to use default based on language.</p>
                <input type="text" id="customModel" class="setting-input" data-i18n-placeholder="modelPlaceholder" placeholder="e.g., LiquidAI/LFM2.5-1.2B-Instruct">
                <p class="setting-hint model-defaults" data-i18n="modelDefaults">Defaults: EN/‰∏≠Êñá ‚Üí LFM2.5-1.2B-Instruct | Êó•Êú¨Ë™û ‚Üí LFM2.5-1.2B-JP</p>
            </div>

            <div class="setting-group">
                <label class="setting-label" data-i18n="promptLabel">Custom Prompt Template</label>
                <p class="setting-hint" data-i18n="promptHint">Use {text} as placeholder for input text. Leave empty to use default.</p>
                <textarea id="customPrompt" data-i18n-placeholder="promptPlaceholder" placeholder="Enter custom prompt..."></textarea>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span data-i18n="temperatureLabel">Temperature</span>: <span id="tempValue">0.3</span>
                </label>
                <p class="setting-hint" data-i18n="temperatureHint">Lower = more focused, Higher = more creative</p>
                <input type="range" id="temperature" min="0.1" max="1.0" step="0.1" value="0.3" oninput="updateTempValue()">
                <div class="range-labels">
                    <span data-i18n="focused">Focused</span>
                    <span data-i18n="creative">Creative</span>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span data-i18n="maxTokensLabel">Max Output Length</span>: <span id="tokensValue">512</span>
                </label>
                <p class="setting-hint" data-i18n="maxTokensHint">Maximum number of tokens in the summary</p>
                <input type="range" id="maxTokens" min="128" max="1024" step="64" value="512" oninput="updateTokensValue()">
                <div class="range-labels">
                    <span data-i18n="shorter">Shorter</span>
                    <span data-i18n="longer">Longer</span>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn-reset" onclick="resetSettings()" data-i18n="resetBtn">Reset to Default</button>
                <button onclick="saveSettings()" data-i18n="saveBtn">Save Settings</button>
            </div>
        </div>
    </div>

    <script>
        // Internationalization (i18n)
        const translations = {
            en: {
                title: "Local Summarizer",
                subtitle: "Private AI Text Summarization",
                privacy: "100% Private - Runs Locally",
                inputTitle: "Input Text",
                outputTitle: "Summary",
                inputPlaceholder: "Enter text to summarize...",
                outputPlaceholder: "Summary will appear here...",
                summarizeBtn: "Generate Summary",
                clearBtn: "Clear",
                processing: "Processing...",
                generating: "Generating AI summary...",
                generatingFirst: "Downloading model & generating (first run may take a few minutes)...",
                complete: "Summary complete",
                errorNoText: "Please enter text to summarize",
                errorConnection: "Cannot connect to backend server. Please ensure backend.py is running.",
                errorGeneric: "An error occurred: ",
                sampleNote: "Sample call transcript loaded. Feel free to replace with your own text.",
                noticeTitle: "First Run Notice",
                noticeText: "The AI model (~2.5GB) will be downloaded on first use. This may take a few minutes depending on your connection. Subsequent runs will be much faster.",
                settingsTitle: "Settings",
                modelLabel: "Model",
                modelHint: "Enter a Hugging Face model ID. Leave empty to use default based on language.",
                modelPlaceholder: "e.g., LiquidAI/LFM2.5-1.2B-Instruct",
                modelDefaults: "Defaults: EN/‰∏≠Êñá ‚Üí LFM2.5-1.2B-Instruct | Êó•Êú¨Ë™û ‚Üí LFM2.5-1.2B-JP",
                promptLabel: "Custom Prompt Template",
                promptHint: "Use {text} as placeholder for input text. Leave empty to use default.",
                promptPlaceholder: "Example: Summarize the following text in bullet points:\n\n{text}\n\nSummary:",
                temperatureLabel: "Temperature",
                temperatureHint: "Lower = more focused, Higher = more creative",
                maxTokensLabel: "Max Output Length",
                maxTokensHint: "Maximum number of tokens in the summary",
                focused: "Focused",
                creative: "Creative",
                shorter: "Shorter",
                longer: "Longer",
                resetBtn: "Reset to Default",
                saveBtn: "Save Settings",
                sampleText: `Customer: Hello, I have a question about your service.

Support: Thank you for calling. This is John from Customer Support. How may I help you today?

Customer: I ordered a product online last week, but it hasn't arrived yet. My order number is #12345.

Support: I apologize for the inconvenience. Let me check that for you right away. Please hold on a moment.

(Checking)

Support: Thank you for waiting. I've located your order. Due to shipping delays, your package is running about 2 days behind schedule. It should be dispatched today.

Customer: I see. When will it arrive?

Support: After dispatch, you can expect delivery within 2-3 business days. You'll be able to track the shipment with a tracking number. Would you like me to send you the tracking information?

Customer: Yes, please. My email is example@email.com

Support: Certainly. I'll send you an email with the tracking number today. As an apology for the delay, I'd also like to include a 10% discount coupon for your next order.

Customer: Thank you, I appreciate that.

Support: Thank you for your understanding. Is there anything else I can help you with?

Customer: No, that's all.

Support: Thank you for calling. Have a great day!`
            },
            zh: {
                title: "Êú¨Âú∞ÊëòË¶ÅÂ∑•ÂÖ∑",
                subtitle: "ÁßÅÊúâAIÊñáÊú¨ÊëòË¶Å",
                privacy: "100% ÈöêÁßÅ‰øùÊä§ - Êú¨Âú∞ËøêË°å",
                inputTitle: "ËæìÂÖ•ÊñáÊú¨",
                outputTitle: "ÊëòË¶ÅÁªìÊûú",
                inputPlaceholder: "ËØ∑ËæìÂÖ•ÈúÄË¶ÅÊëòË¶ÅÁöÑÊñáÊú¨...",
                outputPlaceholder: "ÊëòË¶ÅÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå...",
                summarizeBtn: "ÁîüÊàêÊëòË¶Å",
                clearBtn: "Ê∏ÖÁ©∫",
                processing: "Â§ÑÁêÜ‰∏≠...",
                generating: "Ê≠£Âú®ÁîüÊàêAIÊëòË¶Å...",
                generatingFirst: "Ê≠£Âú®‰∏ãËΩΩÊ®°ÂûãÂπ∂ÁîüÊàêÔºàÈ¶ñÊ¨°ËøêË°åÂèØËÉΩÈúÄË¶ÅÂá†ÂàÜÈíüÔºâ...",
                complete: "ÊëòË¶ÅÂÆåÊàê",
                errorNoText: "ËØ∑ËæìÂÖ•ÈúÄË¶ÅÊëòË¶ÅÁöÑÊñáÊú¨",
                errorConnection: "Êó†Ê≥ïËøûÊé•Âà∞ÂêéÁ´ØÊúçÂä°Âô®„ÄÇËØ∑Á°Æ‰øù backend.py Ê≠£Âú®ËøêË°å„ÄÇ",
                errorGeneric: "ÂèëÁîüÈîôËØØÔºö",
                sampleNote: "Â∑≤Âä†ËΩΩÁ§∫‰æãÈÄöËØùËÆ∞ÂΩï„ÄÇÊÇ®ÂèØ‰ª•ÊõøÊç¢‰∏∫Ëá™Â∑±ÁöÑÊñáÊú¨„ÄÇ",
                noticeTitle: "È¶ñÊ¨°ËøêË°åÊèêÁ§∫",
                noticeText: "AIÊ®°ÂûãÔºàÁ∫¶2.5GBÔºâÂ∞ÜÂú®È¶ñÊ¨°‰ΩøÁî®Êó∂‰∏ãËΩΩ„ÄÇÊ†πÊçÆÊÇ®ÁöÑÁΩëÁªúÁä∂ÂÜµÔºåËøôÂèØËÉΩÈúÄË¶ÅÂá†ÂàÜÈíü„ÄÇ‰πãÂêéÁöÑËøêË°å‰ºöÂø´ÂæàÂ§ö„ÄÇ",
                settingsTitle: "ËÆæÁΩÆ",
                modelLabel: "Ê®°Âûã",
                modelHint: "ËæìÂÖ• Hugging Face Ê®°Âûã ID„ÄÇÁïôÁ©∫ÂàôÊ†πÊçÆËØ≠Ë®ÄËá™Âä®ÈÄâÊã©ÈªòËÆ§Ê®°Âûã„ÄÇ",
                modelPlaceholder: "‰æãÂ¶ÇÔºöLiquidAI/LFM2.5-1.2B-Instruct",
                modelDefaults: "ÈªòËÆ§ÔºöEN/‰∏≠Êñá ‚Üí LFM2.5-1.2B-Instruct | Êó•Êú¨Ë™û ‚Üí LFM2.5-1.2B-JP",
                promptLabel: "Ëá™ÂÆö‰πâÊèêÁ§∫ËØçÊ®°Êùø",
                promptHint: "‰ΩøÁî® {text} ‰Ωú‰∏∫ËæìÂÖ•ÊñáÊú¨ÁöÑÂç†‰ΩçÁ¨¶„ÄÇÁïôÁ©∫Âàô‰ΩøÁî®ÈªòËÆ§ÊèêÁ§∫ËØç„ÄÇ",
                promptPlaceholder: "Á§∫‰æãÔºöËØ∑Áî®Ë¶ÅÁÇπÂΩ¢ÂºèÊÄªÁªì‰ª•‰∏ãÊñáÊú¨Ôºö\n\n{text}\n\nÊëòË¶ÅÔºö",
                temperatureLabel: "Ê∏©Â∫¶",
                temperatureHint: "ËæÉ‰Ωé = Êõ¥‰∏ìÊ≥®ÔºåËæÉÈ´ò = Êõ¥ÊúâÂàõÊÑè",
                maxTokensLabel: "ÊúÄÂ§ßËæìÂá∫ÈïøÂ∫¶",
                maxTokensHint: "ÊëòË¶ÅÁöÑÊúÄÂ§ßtokenÊï∞Èáè",
                focused: "‰∏ìÊ≥®",
                creative: "ÂàõÊÑè",
                shorter: "ËæÉÁü≠",
                longer: "ËæÉÈïø",
                resetBtn: "ÊÅ¢Â§çÈªòËÆ§",
                saveBtn: "‰øùÂ≠òËÆæÁΩÆ",
                sampleText: `ÂÆ¢Êà∑Ôºö‰Ω†Â•ΩÔºåÊàëÊÉ≥Âí®ËØ¢‰∏Ä‰∏ã‰Ω†‰ª¨ÁöÑÊúçÂä°„ÄÇ

ÂÆ¢ÊúçÔºöÊÑüË∞¢ÊÇ®ÁöÑÊù•Áîµ„ÄÇÊàëÊòØÂÆ¢ÊúçÂ∞èÁéãÔºåËØ∑ÈóÆÊúâ‰ªÄ‰πàÂèØ‰ª•Â∏ÆÊÇ®Ôºü

ÂÆ¢Êà∑ÔºöÊàë‰∏äÂë®Âú®ÁΩë‰∏äËÆ¢Ë¥≠‰∫Ü‰∏Ä‰ª∂ÂïÜÂìÅÔºå‰ΩÜËøòÊ≤°ÊúâÊî∂Âà∞„ÄÇÊàëÁöÑËÆ¢ÂçïÂè∑ÊòØ #12345„ÄÇ

ÂÆ¢ÊúçÔºöÈùûÂ∏∏Êä±Ê≠âÁªôÊÇ®Â∏¶Êù•‰∏ç‰æø„ÄÇÊàëÈ©¨‰∏ä‰∏∫ÊÇ®Êü•ËØ¢ÔºåËØ∑Á®çÁ≠â„ÄÇ

ÔºàÊü•ËØ¢‰∏≠Ôºâ

ÂÆ¢ÊúçÔºöËÆ©ÊÇ®‰πÖÁ≠â‰∫Ü„ÄÇÊàëÂ∑≤ÁªèÊü•Âà∞ÊÇ®ÁöÑËÆ¢Âçï‰∫Ü„ÄÇÁî±‰∫éÁâ©ÊµÅÂª∂ËØØÔºåÊÇ®ÁöÑÂåÖË£πÊØîÈ¢ÑÊúüÊôö‰∫ÜÂ§ßÁ∫¶2Â§©„ÄÇÈ¢ÑËÆ°‰ªäÂ§©‰ºöÂèëÂá∫„ÄÇ

ÂÆ¢Êà∑ÔºöÂ•ΩÁöÑ„ÄÇ‰ªÄ‰πàÊó∂ÂÄôËÉΩÊî∂Âà∞Ôºü

ÂÆ¢ÊúçÔºöÂèëË¥ßÂêéÔºåÈ¢ÑËÆ°2-3‰∏™Â∑•‰ΩúÊó•ÂÜÖÈÄÅËææ„ÄÇÊÇ®ÂèØ‰ª•ÈÄöËøáÂø´ÈÄíÂçïÂè∑ËøΩË∏™Áâ©ÊµÅ‰ø°ÊÅØ„ÄÇÈúÄË¶ÅÊàëÊääÂø´ÈÄíÂçïÂè∑ÂèëÁªôÊÇ®ÂêóÔºü

ÂÆ¢Êà∑ÔºöÂ•ΩÁöÑÔºåÈ∫ªÁÉ¶‰Ω†‰∫Ü„ÄÇÊàëÁöÑÈÇÆÁÆ±ÊòØ example@email.com

ÂÆ¢ÊúçÔºöÂ•ΩÁöÑ„ÄÇÊàë‰ªäÂ§©‰ºöÊääÂø´ÈÄíÂçïÂè∑ÂèëÈÄÅÂà∞ÊÇ®ÁöÑÈÇÆÁÆ±„ÄÇÂè¶Â§ñÔºå‰∏∫‰∫ÜË°®Á§∫Ê≠âÊÑèÔºåÊàë‰ª¨‰ºöÈôÑ‰∏ä‰∏ãÊ¨°Ë¥≠Áâ©ÂèØÁî®ÁöÑ9Êäò‰ºòÊÉ†Âà∏„ÄÇ

ÂÆ¢Êà∑ÔºöË∞¢Ë∞¢ÔºåÂ§™Â•Ω‰∫Ü„ÄÇ

ÂÆ¢ÊúçÔºöÊÑüË∞¢ÊÇ®ÁöÑÁêÜËß£„ÄÇËØ∑ÈóÆËøòÊúâÂÖ∂‰ªñÂèØ‰ª•Â∏ÆÊÇ®ÁöÑÂêóÔºü

ÂÆ¢Êà∑ÔºöÊ≤°Êúâ‰∫ÜÔºåË∞¢Ë∞¢„ÄÇ

ÂÆ¢ÊúçÔºöÊÑüË∞¢ÊÇ®ÁöÑÊù•ÁîµÔºåÁ•ùÊÇ®ÁîüÊ¥ªÊÑâÂø´ÔºÅ`
            },
            ja: {
                title: "„É≠„Éº„Ç´„É´Ë¶ÅÁ¥Ñ„ÉÑ„Éº„É´",
                subtitle: "„Éó„É©„Ç§„Éô„Éº„ÉàAI„ÉÜ„Ç≠„Çπ„ÉàË¶ÅÁ¥Ñ",
                privacy: "100% „Éó„É©„Ç§„Éô„Éº„Éà - „É≠„Éº„Ç´„É´ÂÆüË°å",
                inputTitle: "ÂÖ•Âäõ„ÉÜ„Ç≠„Çπ„Éà",
                outputTitle: "Ë¶ÅÁ¥ÑÁµêÊûú",
                inputPlaceholder: "Ë¶ÅÁ¥Ñ„Åó„Åü„ÅÑ„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...",
                outputPlaceholder: "Ë¶ÅÁ¥Ñ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô...",
                summarizeBtn: "Ë¶ÅÁ¥Ñ„ÇíÁîüÊàê",
                clearBtn: "„ÇØ„É™„Ç¢",
                processing: "Âá¶ÁêÜ‰∏≠...",
                generating: "AIË¶ÅÁ¥Ñ„ÇíÁîüÊàê‰∏≠...",
                generatingFirst: "„É¢„Éá„É´„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ‰∏≠ÔºàÂàùÂõû„ÅØÊï∞ÂàÜ„Åã„Åã„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„ÅôÔºâ...",
                complete: "Ë¶ÅÁ¥Ñ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü",
                errorNoText: "ÂÖ•Âäõ„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
                errorConnection: "„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„Çì„ÄÇbackend.py„ÅåËµ∑Âãï„Åó„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
                errorGeneric: "„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ",
                sampleNote: "„Çµ„É≥„Éó„É´„ÅÆÈÄöË©±Ë®òÈå≤„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇËá™Áî±„Å´„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•„ÇåÊõø„Åà„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
                noticeTitle: "ÂàùÂõûÂÆüË°å„ÅÆ„ÅäÁü•„Çâ„Åõ",
                noticeText: "AI„É¢„Éá„É´ÔºàÁ¥Ñ2.5GBÔºâ„ÅØÂàùÂõû‰ΩøÁî®ÊôÇ„Å´„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åï„Çå„Åæ„Åô„ÄÇÊé•Á∂öÁä∂Ê≥Å„Å´„Çà„ÇäÊï∞ÂàÜ„Åã„Åã„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ2ÂõûÁõÆ‰ª•Èôç„ÅØÈ´òÈÄü„Å´Âãï‰Ωú„Åó„Åæ„Åô„ÄÇ",
                settingsTitle: "Ë®≠ÂÆö",
                modelLabel: "„É¢„Éá„É´",
                modelHint: "Hugging Face „ÅÆ„É¢„Éá„É´ ID „ÇíÂÖ•Âäõ„ÄÇÁ©∫Ê¨Ñ„ÅÆÂ†¥Âêà„ÅØË®ÄË™û„Å´Âøú„Åò„Åü„Éá„Éï„Ç©„É´„Éà„Çí‰ΩøÁî®„ÄÇ",
                modelPlaceholder: "‰æãÔºöLiquidAI/LFM2.5-1.2B-Instruct",
                modelDefaults: "„Éá„Éï„Ç©„É´„ÉàÔºöEN/‰∏≠Êñá ‚Üí LFM2.5-1.2B-Instruct | Êó•Êú¨Ë™û ‚Üí LFM2.5-1.2B-JP",
                promptLabel: "„Ç´„Çπ„Çø„É†„Éó„É≠„É≥„Éó„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà",
                promptHint: "{text} „ÇíÂÖ•Âäõ„ÉÜ„Ç≠„Çπ„Éà„ÅÆ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„Å®„Åó„Å¶‰ΩøÁî®„ÄÇÁ©∫Ê¨Ñ„ÅÆÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„Éà„Çí‰ΩøÁî®„ÄÇ",
                promptPlaceholder: "‰æãÔºö‰ª•‰∏ã„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÇíÁÆáÊù°Êõ∏„Åç„ÅßË¶ÅÁ¥Ñ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö\n\n{text}\n\nË¶ÅÁ¥ÑÔºö",
                temperatureLabel: "Ê∏©Â∫¶",
                temperatureHint: "‰Ωé„ÅÑ = „Çà„ÇäÊ≠£Á¢∫„ÄÅÈ´ò„ÅÑ = „Çà„ÇäÂâµÈÄ†ÁöÑ",
                maxTokensLabel: "ÊúÄÂ§ßÂá∫ÂäõÈï∑",
                maxTokensHint: "Ë¶ÅÁ¥Ñ„ÅÆÊúÄÂ§ß„Éà„Éº„ÇØ„É≥Êï∞",
                focused: "Ê≠£Á¢∫",
                creative: "ÂâµÈÄ†ÁöÑ",
                shorter: "Áü≠„ÅÑ",
                longer: "Èï∑„ÅÑ",
                resetBtn: "„Éá„Éï„Ç©„É´„Éà„Å´Êàª„Åô",
                saveBtn: "Ë®≠ÂÆö„Çí‰øùÂ≠ò",
                sampleText: `È°ßÂÆ¢: „ÇÇ„Åó„ÇÇ„Åó„ÄÅÂæ°Á§æ„ÅÆ„Çµ„Éº„Éì„Çπ„Å´„Å§„ÅÑ„Å¶Ë≥™Âïè„Åå„ÅÇ„Çã„ÅÆ„Åß„Åô„Åå„ÄÇ

ÊãÖÂΩìËÄÖ: „ÅäÈõªË©±„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ„Ç´„Çπ„Çø„Éû„Éº„Çµ„Éù„Éº„Éà„ÅÆÁî∞‰∏≠„Å®Áî≥„Åó„Åæ„Åô„ÄÇ„Å©„ÅÆ„Çà„ÅÜ„Å™„ÅîË≥™Âïè„Åß„Åó„Çá„ÅÜ„Åã„ÄÇ

È°ßÂÆ¢: ÂÖàÈÄ±„ÄÅ„Ç™„É≥„É©„Ç§„É≥„ÅßÂïÜÂìÅ„ÇíÊ≥®Êñá„Åó„Åü„ÅÆ„Åß„Åô„Åå„ÄÅ„Åæ„Å†Â±ä„ÅÑ„Å¶„ÅÑ„Å™„ÅÑ„Çì„Åß„Åô„ÄÇÊ≥®ÊñáÁï™Âè∑„ÅØ#12345„Åß„Åô„ÄÇ

ÊãÖÂΩìËÄÖ: „Åî‰∏ç‰æø„Çí„Åä„Åã„Åë„Åó„Å¶Áî≥„ÅóË®≥„Åî„Åñ„ÅÑ„Åæ„Åõ„Çì„ÄÇ„Åô„Åê„Å´Á¢∫Ë™ç„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åô„ÄÇÂ∞ë„ÄÖ„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ„ÄÇ

ÔºàÁ¢∫Ë™ç‰∏≠Ôºâ

ÊãÖÂΩìËÄÖ: „ÅäÂæÖ„Åü„Åõ„ÅÑ„Åü„Åó„Åæ„Åó„Åü„ÄÇ„ÅîÊ≥®Êñá„ÇíÁ¢∫Ë™ç„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åó„Åü„ÄÇÈÖçÈÄÅÊ•≠ËÄÖ„ÅÆÈÅÖÂª∂„Å´„Çà„Çä„ÄÅÈÄöÂ∏∏„Çà„Çä2Êó•Á®ãÂ∫¶ÈÅÖ„Çå„Å¶„ÅÑ„Çã„Çà„ÅÜ„Åß„Åô„ÄÇÊú¨Êó•‰∏≠„Å´Áô∫ÈÄÅ„Åï„Çå„Çã‰∫àÂÆö„Åß„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ

È°ßÂÆ¢: „Åù„ÅÜ„Åß„Åô„Åã„ÄÇ„ÅÑ„Å§È†ÉÂ±ä„Åç„Åæ„Åô„Åã„ÄÇ

ÊãÖÂΩìËÄÖ: Áô∫ÈÄÅÂæå„ÄÅ2„Äú3Âñ∂Ê•≠Êó•„Åß„ÅäÂ±ä„Åë„Åß„Åç„ÇãË¶ãËæº„Åø„Åß„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇÈÖçÈÄÅÁä∂Ê≥Å„ÅØËøΩË∑°Áï™Âè∑„Åß„ÅîÁ¢∫Ë™ç„ÅÑ„Åü„Å†„Åë„Åæ„Åô„ÄÇËøΩË∑°Áï™Âè∑„Çí„ÅäÈÄÅ„Çä„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åó„Çá„ÅÜ„Åã„ÄÇ

È°ßÂÆ¢: „ÅØ„ÅÑ„ÄÅ„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅØ example@email.com „Åß„Åô„ÄÇ

ÊãÖÂΩìËÄÖ: „Åã„Åó„Åì„Åæ„Çä„Åæ„Åó„Åü„ÄÇËøΩË∑°Áï™Âè∑„ÇíË®òËºâ„Åó„Åü„É°„Éº„É´„ÇíÊú¨Êó•‰∏≠„Å´„ÅäÈÄÅ„Çä„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ„Åæ„Åü„ÄÅÈÅÖÂª∂„ÅÆ„ÅäË©´„Å≥„Å®„Åó„Å¶„ÄÅÊ¨°Âõû„ÅÆ„ÅîÊ≥®Êñá„Åß‰ΩøÁî®„Åß„Åç„Çã10%Ââ≤Âºï„ÇØ„Éº„Éù„É≥„ÇÇ„ÅäÈÄÅ„Çä„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åô„ÄÇ

È°ßÂÆ¢: „ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇÂä©„Åã„Çä„Åæ„Åô„ÄÇ

ÊãÖÂΩìËÄÖ: „Åì„Å°„Çâ„Åì„Åù„ÄÅ„ÅîÁêÜËß£„ÅÑ„Åü„Å†„Åç„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ‰ªñ„Å´„ÅîË≥™Âïè„ÅØ„Åî„Åñ„ÅÑ„Åæ„Åô„Åã„ÄÇ

È°ßÂÆ¢: „ÅÑ„ÅÑ„Åà„ÄÅÂ§ß‰∏àÂ§´„Åß„Åô„ÄÇ

ÊãÖÂΩìËÄÖ: „ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„ÄÇ‰ªäÂæå„Å®„ÇÇ„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇÂ§±Á§º„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ`
            }
        };

        let currentLang = 'en';
        let isFirstRun = !localStorage.getItem('hasRunBefore');
        let settings = loadSettings();

        function loadSettings() {
            const saved = localStorage.getItem('summarizerSettings');
            return saved ? JSON.parse(saved) : {
                customModel: '',
                customPrompt: '',
                temperature: 0.3,
                maxTokens: 512
            };
        }

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];

            // Update body class for font
            document.body.className = `lang-${lang}`;

            // Update all translatable elements
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) {
                    el.textContent = t[key];
                }
            });

            // Update placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (t[key]) {
                    el.placeholder = t[key];
                }
            });

            // Update output placeholder
            const outputEl = document.getElementById('outputText');
            outputEl.setAttribute('data-placeholder', t.outputPlaceholder);

            // Update HTML lang attribute
            document.documentElement.lang = lang;

            // Update language button states
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Load sample text for the selected language
            document.getElementById('inputText').value = t.sampleText;

            // Clear output
            outputEl.innerHTML = '';
            document.getElementById('status').textContent = '';

            // Save preference
            localStorage.setItem('preferredLanguage', lang);
        }

        // Convert markdown-like text to HTML
        function markdownToHtml(text) {
            let html = text;

            // Convert „ÄêHeader„Äë style headers to <h3> (Japanese/Chinese style)
            html = html.replace(/„Äê(.+?)„Äë/g, '<h3>$1</h3>');

            // Convert ### Header style to <h3>
            html = html.replace(/^###\s+(.+)$/gm, '<h3>$1</h3>');
            html = html.replace(/^##\s+(.+)$/gm, '<h3>$1</h3>');

            // Convert **Header** on its own line to <h3> (English style)
            html = html.replace(/^\*\*(.+?)\*\*$/gm, '<h3>$1</h3>');

            // Split by lines and process each line
            const lines = html.split('\n');
            let result = [];
            let inList = false;
            let listType = null; // 'ul' or 'ol'

            for (let line of lines) {
                line = line.trim();

                if (!line) {
                    if (inList) {
                        result.push(listType === 'ol' ? '</ol>' : '</ul>');
                        inList = false;
                        listType = null;
                    }
                    continue;
                }

                // Check if line is a bullet point
                const bulletMatch = line.match(/^[-*]\s+(.+)$/);
                // Check if line is a numbered list item
                const numberMatch = line.match(/^\d+[.)]\s+(.+)$/);

                if (bulletMatch) {
                    if (inList && listType !== 'ul') {
                        result.push('</ol>');
                        inList = false;
                    }
                    if (!inList) {
                        result.push('<ul>');
                        inList = true;
                        listType = 'ul';
                    }
                    result.push(`<li>${formatInline(bulletMatch[1])}</li>`);
                } else if (numberMatch) {
                    if (inList && listType !== 'ol') {
                        result.push('</ul>');
                        inList = false;
                    }
                    if (!inList) {
                        result.push('<ol>');
                        inList = true;
                        listType = 'ol';
                    }
                    result.push(`<li>${formatInline(numberMatch[1])}</li>`);
                } else if (line.startsWith('<h3>')) {
                    if (inList) {
                        result.push(listType === 'ol' ? '</ol>' : '</ul>');
                        inList = false;
                        listType = null;
                    }
                    result.push(line);
                } else {
                    if (inList) {
                        result.push(listType === 'ol' ? '</ol>' : '</ul>');
                        inList = false;
                        listType = null;
                    }
                    result.push(`<p>${formatInline(line)}</p>`);
                }
            }

            if (inList) {
                result.push(listType === 'ol' ? '</ol>' : '</ul>');
            }

            return result.join('\n');
        }

        // Format inline markdown elements
        function formatInline(text) {
            // Bold: **text** or __text__
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/__(.+?)__/g, '<strong>$1</strong>');
            // Italic: *text* or _text_
            text = text.replace(/\*([^*]+)\*/g, '<em>$1</em>');
            text = text.replace(/_([^_]+)_/g, '<em>$1</em>');
            // Inline code: `code`
            text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
            return text;
        }

        async function summarize() {
            const t = translations[currentLang];
            const inputText = document.getElementById('inputText').value.trim();
            const outputElement = document.getElementById('outputText');
            const statusElement = document.getElementById('status');
            const button = document.getElementById('summarizeBtn');

            if (!inputText) {
                statusElement.textContent = t.errorNoText;
                statusElement.className = 'status error';
                return;
            }

            // Disable button and show loading state
            button.disabled = true;
            button.textContent = t.processing;
            outputElement.className = 'output loading';
            outputElement.textContent = '';
            statusElement.textContent = isFirstRun ? t.generatingFirst : t.generating;
            statusElement.className = 'status';

            try {
                // Build request body
                const requestBody = {
                    text: inputText,
                    language: currentLang
                };

                // Add custom settings if configured
                if (settings.customModel) {
                    requestBody.model = settings.customModel;
                }
                if (settings.customPrompt) {
                    requestBody.custom_prompt = settings.customPrompt;
                }
                if (settings.temperature !== 0.3) {
                    requestBody.temperature = settings.temperature;
                }
                if (settings.maxTokens !== 512) {
                    requestBody.max_tokens = settings.maxTokens;
                }

                // Call backend API with language parameter
                const response = await fetch('http://localhost:8000/summarize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Backend error');
                }

                const data = await response.json();
                const summary = data.summary;

                // Convert markdown to HTML and display
                outputElement.innerHTML = markdownToHtml(summary);
                outputElement.className = 'output';
                statusElement.textContent = t.complete;
                statusElement.className = 'status success';

                // Mark first run complete
                if (isFirstRun) {
                    localStorage.setItem('hasRunBefore', 'true');
                    isFirstRun = false;
                }
            } catch (error) {
                outputElement.className = 'output';
                outputElement.textContent = '';

                // Provide helpful error messages
                let errorMessage = t.errorGeneric;
                if (error.message.includes('Failed to fetch')) {
                    errorMessage = t.errorConnection;
                } else {
                    errorMessage += error.message;
                }

                statusElement.textContent = errorMessage;
                statusElement.className = 'status error';
            } finally {
                button.disabled = false;
                button.textContent = t.summarizeBtn;
            }
        }

        function clearAll() {
            document.getElementById('inputText').value = '';
            document.getElementById('outputText').innerHTML = '';
            document.getElementById('status').textContent = '';
        }

        // Settings functions
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            document.getElementById('customModel').value = settings.customModel || '';
            document.getElementById('customPrompt').value = settings.customPrompt;
            document.getElementById('temperature').value = settings.temperature;
            document.getElementById('maxTokens').value = settings.maxTokens;
            updateTempValue();
            updateTokensValue();
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function updateTempValue() {
            document.getElementById('tempValue').textContent = document.getElementById('temperature').value;
        }

        function updateTokensValue() {
            document.getElementById('tokensValue').textContent = document.getElementById('maxTokens').value;
        }

        function saveSettings() {
            settings = {
                customModel: document.getElementById('customModel').value.trim(),
                customPrompt: document.getElementById('customPrompt').value,
                temperature: parseFloat(document.getElementById('temperature').value),
                maxTokens: parseInt(document.getElementById('maxTokens').value)
            };
            localStorage.setItem('summarizerSettings', JSON.stringify(settings));
            closeSettings();
        }

        function resetSettings() {
            settings = {
                customModel: '',
                customPrompt: '',
                temperature: 0.3,
                maxTokens: 512
            };
            document.getElementById('customModel').value = '';
            document.getElementById('customPrompt').value = '';
            document.getElementById('temperature').value = 0.3;
            document.getElementById('maxTokens').value = 512;
            updateTempValue();
            updateTokensValue();
            localStorage.removeItem('summarizerSettings');
        }

        function dismissNotice() {
            document.getElementById('firstRunNotice').classList.remove('show');
            localStorage.setItem('noticeDismissed', 'true');
        }

        // Close modal on overlay click
        document.getElementById('settingsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSettings();
            }
        });

        // Allow Enter key to trigger summarization (Ctrl/Cmd + Enter)
        document.getElementById('inputText').addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                summarize();
            }
        });

        // Close modal on Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeSettings();
            }
        });

        // Initialize with saved language preference or browser language
        document.addEventListener('DOMContentLoaded', function() {
            // Show first run notice if applicable
            if (isFirstRun && !localStorage.getItem('noticeDismissed')) {
                document.getElementById('firstRunNotice').classList.add('show');
            }

            const savedLang = localStorage.getItem('preferredLanguage');
            const browserLang = navigator.language.substring(0, 2);

            let initialLang = 'en';
            if (savedLang && translations[savedLang]) {
                initialLang = savedLang;
            } else if (browserLang === 'ja') {
                initialLang = 'ja';
            } else if (browserLang === 'zh') {
                initialLang = 'zh';
            }

            // Find and click the appropriate language button
            const langBtns = document.querySelectorAll('.lang-btn');
            langBtns.forEach(btn => {
                if ((initialLang === 'en' && btn.textContent === 'EN') ||
                    (initialLang === 'zh' && btn.textContent === '‰∏≠Êñá') ||
                    (initialLang === 'ja' && btn.textContent === 'Êó•Êú¨Ë™û')) {
                    btn.click();
                }
            });
        });
    </script>
</body>
</html>
